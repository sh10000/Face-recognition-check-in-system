<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">`
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>学生签到页面</title>
    <link href="../static/css/bootstrap.min.css" rel="stylesheet">
    <script src="../static/js/jquery-1.11.3.min.js"></script>
    <script src="../static/js/bootstrap.min.js"></script>
    <script src="../static/js/canvas-to-blob.js"></script>
<!--     <script src="../static/js/canvas2image.js"></script> -->
</head>
<body>
	<div class="container">
  		<!-- 网站头部 -->
		    <div class="row">
		   	 	<div class="col-xs-12" style="border: 2px soid blueviolet;">
		   	 		<h1>欢迎来到XX在线学习平台</h1>
		   	 	</div>
		   	</div> 

		   	 
		   	<!--  导航条 -->
		   	<nav class="navbar navbar-inverse">
				<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
				    <ul class="nav navbar-nav">
				    	<li><a href="login.html">登录入口</a></li>
				      	<li class="active"><a href="#">学生签到页面</a></li>
				      
				        <li class="dropdown">
				          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">更多<span class="caret"></span></a>
				          <ul class="dropdown-menu">
				            <li><a href="#">帮助信息</a></li>
				      	    <li><a href="#">。。。</a></li>
				            <li role="separator" class="divider"></li>
				            <li><a href="#">。。。</a></li>
				          </ul>
				        </li>
				    </ul>

				    <form class="navbar-form navbar-right" role="search">
				        <div class="form-group">
				          <input type="text" class="form-control" placeholder="Search">
				        </div>
				        <button type="submit" class="btn btn-default">Submit</button>
				    </form>
				 </div>
				 
			</nav>


		   	<!-- 签到页面主体-->
		   	<div class="row" style="height: 300px;">
		   	 	<div class="container">
					<div class="col-xs-6">
					  	<video id="video"></video>
					  	<h3 class="txt1">识别中，请保持合适距离<br>将面部置于画面中央</h3>
					  	<canvas id="canvas" style="display: none"></canvas>

						</div>
					</div>
					<div class="col-xs-6" id="output"></div>
		   		</div>
		   	</div> 

 			  <button id="btn">确认</button>
		   	<div id="img"><!-- <img src="../static/img/bgtp.gif"> --></div> 
		    <!-- 网站底部 -->
		   	
		   	<div class="row">

		   	</div>

	</div>
  	<script>
		const width = 480;
		const height = 320;
		var video = document.getElementById('video');

		//访问摄像头
		if (navigator.mediaDevices.getUserMedia || navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia) {
		  //调用用户媒体设备, 访问摄像头
		  getUserMedia({video: {width: width, height: height}}, success, error);
		} else {
		  alert('不支持访问用户媒体');
		}

		//访问用户媒体设备的兼容方法
		function getUserMedia(constraints, success, error) {
		  if (navigator.mediaDevices.getUserMedia) {
		      //最新的标准API
		      navigator.mediaDevices.getUserMedia(constraints).then(success).catch(error);
		  } else if (navigator.webkitGetUserMedia) {
		      //webkit核心浏览器
		      navigator.webkitGetUserMedia(constraints, success, error)
		  } else if (navigator.mozGetUserMedia) {
		      //firfox浏览器
		      navigator.mozGetUserMedia(constraints, success, error);
		  } else if (navigator.getUserMedia) {
		      //旧版API
		      navigator.getUserMedia(constraints, success, error);
		  }
		}



		//成功回调
		function success(stream) {
		  console.log('成功');
		  //兼容webkit核心浏览器
		  // const CompatibleURL = window.URL || window.webkitURL;
		  //将视频流设置为video元素的源
		  // video.src = CompatibleURL.createObjectURL(stream);
		  video.srcObject = stream;
		  video.play();

		}

		//失败回调
		function error(error) {
		  console.log('失败');
		  console.log("访问用户媒体设备失败", error);
		}


	    		
		var initialize = function() {
			output = document.getElementById("output");
			video = document.getElementById("video");
			// video.addEventListener('',captureImage);
		};

		var captureImage = function() {
			var canvas = document.getElementById("canvas");
			canvas.width = video.videoWidth * 0.8;
			canvas.height = video.videoHeight * 0.8;
			canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
			var img = document.createElement("img");
			img.src = canvas.toDataURL("image/png");
			output.appendChild(img);
			// const xhr = new XMLHttpRequest();
			// xhr.open('POST', 'login.html');
			// xhr.send("img");
			// xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
			var formdata = new FormData();
			formdata.append("file",img.src);
			$.ajax({
				type:'POST',
				url:'https://www.baidu.com/',
				data:formdata,
				success:function(){alert("success")},
				dataType: 'json',
				async: false,
				cache: false,
				contentType: false,
				processData: false,

      })
		};


		setInterval(captureImage,3000);

		setTimeout(function(){alert("已成功签到！")},10000)

 // function upload(){
 //                 var formdata = new FormData();
 //                  formdata.append("file",document.getElementById("preview").src);
 //                  formdata.append("imagename",document.getElementById("f").value);
 //                 $.ajax({
 //                     type:'POST',
 //                      url:'/scgi/image',
 //                     data:formdata,
 //                      success:function(){
 //                             alert("保存头像成功")
 
 //                             },
 //                    processData:false,
 //                     contentType:false
 //                   })
 //                  $("#upload").hide();
 //             }

		// setInterval(getPicture(),3000);
		// setInterval('alert("hello!")',3000);

		// //向后端发送图片
		// $("#button").click(function(){
		// 	var student = $("#img")
		// 	//1、创建对象
		// 	const xhr = new XMLHttpRequest();
		// 	//2、初始化，设置请求方法和URL
		// 		xhr.open('POST', 'http://127.0.0.1:8000/server');
		// 		xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
		// 		//3、发送请求
		// 		xhr.send(student);
		// 		//4、绑定事件 处理客户端返回的结果
		// 	xhr.onreadystatechange = function () {
		// 	///判断服务器端是否返回了全部的结果
		// 	    if (xhr.readyState === 4) {
		// 	      ///判断状态响应码
		// 	      if (xhr.status >= 200 && xhr.status < 300) {
		// 	        $("#img") = xhr.response; //class为box的标签显示返回结果
		// 	      }
		// 	    }
		// 	}
		// })
  	</script>
</body>
</html>